<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="index.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js library -->
  </head>
  <body>
    <nav class="navbar navbar-inverse justify-content-center">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <img class="logo" src="icon.png" alt="logo" width="50px" />
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#">Carbon Footprint Calculator</a></li>
            <li><a href="#">Book Consultation</a></li>
            <li><a href="#">Green Energy Market News</a></li>
            <li><a href="#">About</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Account</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container main1">
      <div class="row">
        <div class="col-xs-6">
          <h1>Solar Panels like <em>nowhere</em> else</h1>
          <p>Solar panels turn the sun's energy into usable electricity. Solar panels – also known as <strong>photovoltaics (PV)</strong> – contain electrons, which start moving when hit with direct sunlight. The moving electrons create an electric current, kind of like a stream of energy, which is then channelled and turned into usable electricity. The electricity is then sent out of the solar panel through wires, ready to power your gadgets, lights or even your electric vehicle, or it can be sent back to the grid, with suppliers paying you for that energy.</p>
          <form action="https://www.google.com">
            <input class="readmore1" type="submit" value="Read More"/>
          </form>
        </div>
        <img class="solar" src="solar.jpg" alt="house with solar panels"/>
      </div>
    </div>

    <!-- Sidebar for Live Green Energy News -->
    <div class="sidebar">
      <h2>Live Green Market News</h2>
      <ul id="news-list">
      <p>Enter the stock symbol below to fetch the stock price data and see a graph.</p>
      <input type="text" id="stockSymbol" placeholder="Enter stock symbol (e.g., AAPL)" class="form-control" />
      <button onclick="fetchStockData()" class="btn btn-primary mt-3">Get Stock Data</button>
      <h3>Stock Data Graph</h3>
      <canvas id="stockChart" width="400" height="200"></canvas>
      </ul>
    </div>

    
    <script>
      // Function to fetch stock data and display it
      function fetchStockData() {
        const symbol = document.getElementById("stockSymbol").value;
        if (!symbol) {
          alert("Please enter a stock symbol");
          return;
        }

        // Fetch stock data from the server (assuming your backend is running at localhost:5000)
        fetch(`http://localhost:5000/api/stock/${symbol}`)
          .then(response => response.json())
          .then(data => {
            console.log("Stock data:", data);
            displayChart(data);
          })
          .catch(err => {
            console.error("Error fetching stock data:", err);
          });
      }

      // Function to display the stock data in a chart
      function displayChart(data) {
        const ctx = document.getElementById("stockChart");
        const chartData = {
          labels: ["Open", "High", "Low", "Current"], // Labels for the chart (Open, High, Low, Current)
          datasets: [{
            label: 'Stock Prices',
            data: [data.o, data.h, data.l, data.c], // Using Open, High, Low, Current prices
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            fill: true
          }]
        };

        const config = {
          type: 'line',
          data: chartData,
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        };

        // Create a new chart (if one exists, it will update)
        if (window.myChart) {
          window.myChart.destroy(); // Destroy previous chart if exists
        }
        window.myChart = new Chart(ctx, config);
      }

      // WebSocket for live green news
      const socket = new WebSocket("ws://localhost:8080");

      socket.onmessage = (event) => {
        const newsList = document.getElementById("news-list");
        const data = JSON.parse(event.data);

        // Log the full received data to understand its structure
        console.log("Received WebSocket Data:", data);

        if (data && data.data) {
          data.data.forEach((item) => {
            const datetime = item.datetime ? new Date(item.datetime * 1000).toLocaleString() : "No date available";
            const headline = item.headline || "No headline";
            const summary = item.summary || "No summary";

            // Create a new news item
            const listItem = document.createElement("li");
            listItem.innerHTML = `<strong>${headline}</strong> - ${datetime} <p>${summary}</p>`;

            // Add the new news item to the top of the list
            newsList.prepend(listItem);
          });
        } else {
          newsList.innerHTML = "<li>Waiting for live updates...</li>";
        }
      };

      socket.onclose = () => {
        console.log("WebSocket disconnected.");
      };
    </script>
  </body>
</html>
